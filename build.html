<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Build &mdash; TPS  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Test" href="test.html" />
    <link rel="prev" title="Overview" href="overview.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> TPS
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Build</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#obtaining-source-code">Obtaining Source Code</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configuration">Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compile">Compile</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="test.html">Test</a></li>
<li class="toctree-l1"><a class="reference internal" href="running.html">Running</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer.html">Developer Resources</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">TPS</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Build</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">

           <div itemprop="articleBody">
             
  <section id="build">
<h1>Build<a class="headerlink" href="#build" title="Permalink to this headline"></a></h1>
<p>The <code class="docutils literal notranslate"><span class="pre">TPS</span></code> code bases utilizes an <em>autotools</em>-based build system. Before
beginning a build, please ensure that all the necessary software dependencies
are available locally. In general, you will need:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/mfem/mfem">MFEM</a> (and associated dependencies)</p>
<ul>
<li><p>MPI C++ compiler</p></li>
<li><p><a class="reference external" href="https://github.com/hypre-space/hypre">Hypre</a> (v2.16.0 - v2.20.0)</p></li>
<li><p><a class="reference external" href="http://glaros.dtc.umn.edu/gkhome/metis/metis/download">Metis</a></p></li>
</ul>
</li>
<li><p><a class="reference external" href="https://github.com/hpcsi/grvy">GRVY</a></p></li>
<li><p><a class="reference external" href="https://www.hdfgroup.org/downloads/hdf5/source-code/">HDF5</a></p></li>
</ul>
<p>Additional details on building MFEM are available upstream at
<a class="reference external" href="https://mfem.org/building/">https://mfem.org/building/</a>. Note that for CPU-based execution, we often
leverage pre-built binaries for MFEM from the <a class="reference external" href="https://mfem.org/building/">OpenHPC</a> project. Alternatively, for GPU-based execution, MFEM will need
to built locally with a backend that matches the desired GPU vendor
environment. To date, we have successfully used the <strong>CUDA</strong> and <strong>HIP</strong> back
ends.</p>
<hr class="docutils" />
<section id="obtaining-source-code">
<h2>Obtaining Source Code<a class="headerlink" href="#obtaining-source-code" title="Permalink to this headline"></a></h2>
<p>To begin, start with a fresh clone of the <code class="docutils literal notranslate"><span class="pre">TPS</span></code> repository available at
<a class="reference external" href="https://github.com/pecos/tps">https://github.com/pecos/tps</a> (or from a release tarball).  Note that we store
larger binary files used within this repository using git <a class="reference external" href="https://git-lfs.github.com">Large File Storage
(LFS)</a> . Therefore, <code class="docutils literal notranslate"><span class="pre">git-lfs</span></code> is required to
resolve all files in the repository and most Linux distros provide this add-on
functionality. For OSX, you can install this binary via MacPorts or Brew.  You
can confirm a successful git clone configuration by running <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">lfs</span> <span class="pre">track</span></code>
which should return the list of files in the repository currently being tracked
by lfs.</p>
<hr class="docutils" />
<p><strong>Initialization (git checkout only)</strong></p>
<p>When starting directly from within a git checkout, you will need to first
bootstrap the autotools build system by running:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./bootstrap
</pre></div>
</div>
<p>Note that the above step is <strong>not</strong> necessary when starting from a release
tarball.</p>
</section>
<hr class="docutils" />
<section id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline"></a></h2>
<p>Next, use the <code class="docutils literal notranslate"><span class="pre">configure</span></code> script to define various compilation settings and
dependency library paths.  See <code class="docutils literal notranslate"><span class="pre">configure</span> <span class="pre">--help</span></code> for more information on
available options.  At a minimum, you will want to set the variables
<strong>MFEM_INC</strong> and <strong>MFEM_LIB</strong> to the paths of the desired MFEM installation to
resolve header and library files, respectively
Note that this variable may already be set when using pre-installed
versions of MFEM that ship with user-environment modules.  The <code class="docutils literal notranslate"><span class="pre">configure</span></code>
step will differ depending on whether this is a CPU or GPU build. In the GPU
case, additional options are required to specify the desired architecture
types.  Several example <code class="docutils literal notranslate"><span class="pre">configure</span></code> examples are highlighted below:</p>
<p><strong>CPU example using OpenHPC provided MFEM</strong>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ module list
Currently Loaded Modules:
  1) autotools          7) openblas/0.3.7  13) scalapack/2.1.0
  2) prun/2.0           8) superlu/5.2.1   14) petsc/3.14.4
  3) gnu9/9.3.0         9) hypre/2.18.1    15) ptscotch/6.0.6
  4) ohpc              10) metis/5.1.0     16) superlu_dist/6.1.1
  5) libfabric/1.10.1  11) phdf5/1.10.6    17) mfem/4.2
  6) mpich/3.3.2-ofi   12) netcdf/4.7.3

$ ./configure -I$PETSC_INC LDFLAGS=&quot;-L$PETSC_LIB -lpetsc&quot;
</pre></div>
</div>
<p><strong>GPU example using locally built MFEM with CUDA backend</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">CUDA_ARCH</span></code> setting is required to define the target GPU and should match
the target execution hardware:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export MFEM_INC=&lt;yourpath/mfem-cuda&gt;/include
$ export MFEM_LIB=&lt;yourpath&gt;mfem-cuda/lib
$ ./configure --enable-gpu-cuda CUDA_ARCH=sm_75
</pre></div>
</div>
<p><strong>GPU example using locally built MFEM with HIP backend</strong></p>
<p>Similarly, the <code class="docutils literal notranslate"><span class="pre">HIP_ARCH</span></code> setting is required to define the target GPU architecture:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export MFEM_INC=&lt;yourpath/mfem-hip&gt;/include
$ export MFEM_LIB=&lt;yourpath&gt;mfem-hip/lib
$ ./configure --enable-gpu-hip HIP_ARCH=gfx803
</pre></div>
</div>
<p><strong>VPATH builds</strong></p>
<p>The build system also supports VPATH builds which allows for multiple build
configurations against the same source tree. To utilize this capability, create
a <code class="docutils literal notranslate"><span class="pre">build</span></code> directory and descend into this location prior to running
configure:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ mkdir build
$ cd build
$ ../configure &lt;with desired options&gt;
</pre></div>
</div>
</section>
<section id="compile">
<h2>Compile<a class="headerlink" href="#compile" title="Permalink to this headline"></a></h2>
<p>After completing configuration, you can kick off the build using <code class="docutils literal notranslate"><span class="pre">make</span></code>,
e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make          # serial-build, or
$ make -j 8     # parallel-build
</pre></div>
</div>
<p>Assuming the build completed successfully, the resulting solver binary should
be available in the <code class="docutils literal notranslate"><span class="pre">src/</span></code> subdirectory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./src/tps --version

------------------------------------
  _______ _____   _____
 |__   __|  __ \ / ____|
    | |  | |__) | (___
    | |  |  ___/ \___ \
    | |  | |     ____) |
    |_|  |_|    |_____/

TPS Version:  1.0 (dev)
Git Version:  31e48b1
MFEM Version: MFEM v4.2 (release)
------------------------------------
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
<a href="https://github.com/pecos/tps">
  <img style="position: absolute; top: 0; right: 0; border: 0;"
       src="https://github.blog/wp-content/uploads/2008/12/forkme_right_gray_6d6d6d.png"
       alt="GitHub Repo">
</a>

          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Pecos Development Team.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>